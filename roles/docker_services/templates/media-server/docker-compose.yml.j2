services:
  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    environment:
      - PUID={{ puid }}
      - PGID={{ pgid }}
      - TZ={{ timezone }}
      - WEBUI_PORT=8082
      - UMASK=022
    volumes:
      - {{ volume_path }}/config/qbittorrent:/config
      - {{ volume_path }}/downloads:/downloads
    ports:
      - 8082:8082
      - 6881:6881
      - 6881:6881/udp
    networks:
      - traefik-network
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    labels:
      - traefik.enable=true
      - traefik.http.routers.qbittorrent.rule=Host(`{{ qbittorrent_sub_domain }}.{{ server_domain }}`)
      - traefik.http.routers.qbittorrent.entrypoints=websecure
      - traefik.http.services.qbittorrent.loadbalancer.server.port=8082
      - homepage.group=Media
      - homepage.name=qBittorrent
      - homepage.icon=qbittorrent
      - homepage.href={{ url_scheme }}://{{ qbittorrent_sub_domain }}.{{ server_domain }}
      - homepage.description=P2P BitTorrent client
      - homepage.widget.type=qbittorrent
      - homepage.widget.url={{ url_scheme }}://{{ qbittorrent_sub_domain }}.{{ server_domain }}
      - homepage.widget.fields=["leech", "download", "seed", "upload"]

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID={{ puid }}
      - PGID={{ pgid }}
      - TZ={{ timezone }}
    volumes:
      - {{ volume_path }}/config/prowlarr:/config
    ports:
      - 9696:9696
    networks:
      - traefik-network
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    labels:
      - traefik.enable=true
      - traefik.http.routers.prowlarr.rule=Host(`{{ prowlarr_sub_domain }}.{{ server_domain }}`)
      - traefik.http.routers.prowlarr.entrypoints=websecure
      - traefik.http.services.prowlarr.loadbalancer.server.port=9696

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID={{ puid }}
      - PGID={{ pgid }}
      - TZ={{ timezone }}
    volumes:
      - {{ volume_path }}/config/sonarr:/config
      - {{ volume_path }}/complete/tv:/tv
      - {{ volume_path }}/downloads:/downloads
    ports:
      - 8989:8989
    networks:
      - traefik-network
    depends_on:
      - prowlarr
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    labels:
      - traefik.enable=true
      - traefik.http.routers.sonarr.rule=Host(`{{ sonarr_sub_domain }}.{{ server_domain }}`)
      - traefik.http.routers.sonarr.entrypoints=websecure
      - traefik.http.services.sonarr.loadbalancer.server.port=8989

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    environment:
      - PUID={{ puid }}
      - PGID={{ pgid }}
      - TZ={{ timezone }}
    volumes:
      - {{ volume_path }}/config/radarr:/config
      - {{ volume_path }}/complete/movies:/movies
      - {{ volume_path }}/downloads:/downloads
    ports:
      - 7878:7878
    networks:
      - traefik-network
    depends_on:
      - prowlarr
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    labels:
      - traefik.enable=true
      - traefik.http.routers.radarr.rule=Host(`{{ radarr_sub_domain }}.{{ server_domain }}`)
      - traefik.http.routers.radarr.entrypoints=websecure
      - traefik.http.services.radarr.loadbalancer.server.port=7878

  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    environment:
      - PUID={{ puid }}
      - PGID={{ pgid }}
      - TZ={{ timezone }}
    volumes:
      - {{ volume_path }}/config/bazarr:/config
      - {{ volume_path }}/complete/tv:/tv
      - {{ volume_path }}/complete/movies:/movies
    ports:
      - 6767:6767
    networks:
      - traefik-network
    depends_on:
      - sonarr
      - radarr
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    labels:
      - traefik.enable=true
      - traefik.http.routers.bazarr.rule=Host(`{{ bazarr_sub_domain }}.{{ server_domain }}`)
      - traefik.http.routers.bazarr.entrypoints=websecure
      - traefik.http.services.bazarr.loadbalancer.server.port=6767

  jellyfin:
    image: linuxserver/jellyfin:latest
    container_name: jellyfin
    environment:
      - PUID={{ puid }}
      - PGID={{ pgid }}
      - TZ={{ timezone }}
    volumes:
      - {{ volume_path }}/config/jellyfin:/config
      - {{ volume_path }}/complete/tv:/data/tvshows
      - {{ volume_path }}/complete/movies:/data/movies
    ports:
      - 8096:8096
    networks:
      - traefik-network
    restart: unless-stopped
    labels:
      - traefik.enable=true
      - traefik.http.routers.jellyfin.rule=Host(`{{ jellyfin_sub_domain }}.{{ server_domain }}`)
      - traefik.http.routers.jellyfin.entrypoints=websecure
      - traefik.http.services.jellyfin.loadbalancer.server.port=8096
      - homepage.group=Media
      - homepage.name=Jellyfin
      - homepage.icon=jellyfin
      - homepage.href={{ url_scheme }}://{{ jellyfin_sub_domain }}.{{ server_domain }}
      - homepage.description=Watch movies and TV shows.
      - homepage.widget.type=jellyfin
      - homepage.widget.url={{ url_scheme }}://{{ jellyfin_sub_domain }}.{{ server_domain }}
      - homepage.widget.key={{ jellyfin_api_key }}
      - homepage.widget.enableBlocks=true
      - homepage.widget.enableNowPlaying=true
    security_opt:
      - no-new-privileges:true

  jellyseerr:
    container_name: jellyseerr
    image: fallenbagel/jellyseerr:latest
    ports:
      - 5055:5055
    volumes:
      - {{ volume_path }}/config/jellyseerr:/app/config
    environment:
      PUID: {{ puid }}
      PGID: {{ pgid }}
      TZ: {{ timezone }}
    networks:
      - traefik-network
    depends_on:
      - radarr
      - sonarr
      - jellyfin
    restart: unless-stopped
    labels:
      - traefik.enable=true
      - traefik.http.routers.jellyseerr.rule=Host(`{{ jellyseerr_sub_domain }}.{{ server_domain }}`)
      - traefik.http.routers.jellyseerr.entrypoints=websecure
      - traefik.http.services.jellyseerr.loadbalancer.server.port=5055
      - homepage.group=Media
      - homepage.name=Jellyseerr
      - homepage.icon=jellyseerr
      - homepage.href={{ url_scheme }}://{{ jellyseerr_sub_domain }}.{{ server_domain }}
      - homepage.description=Request movies and TV shows.
      - homepage.widget.type=jellyseerr
      - homepage.widget.url={{ url_scheme }}://{{ jellyseerr_sub_domain }}.{{ server_domain }}
      - homepage.widget.key={{ jellyseerr_api_key }}
      - homepage.widget.fields=["pending", "approved", "available"]
    security_opt:
      - no-new-privileges:true

networks:
  traefik-network:
    external: true
